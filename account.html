<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eliane Beautys | Mis cursos</title>
  <style>
    body{font-family:system-ui;margin:0;background:#0b1220;color:#f9fafb;min-height:100vh}
    header{padding:14px 16px;border-bottom:1px solid rgba(148,163,184,.25);display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .card{border:1px solid rgba(148,163,184,.25);border-radius:16px;background:rgba(148,163,184,.06);padding:14px}
    .title{font-weight:1000}
    .muted{color:#9ca3af}
    .btn{display:inline-block;padding:10px 12px;border-radius:12px;text-decoration:none;font-weight:900}
    .primary{background:#22c55e;color:#071018;border:0;cursor:pointer}
    .secondary{background:rgba(56,189,248,.18);color:#f9fafb;border:1px solid rgba(56,189,248,.35)}
    .err{color:#fca5a5;font-weight:700;white-space:pre-wrap}
  

/* ===== Netflix-like cards ===== */
.hero{
  background: linear-gradient(120deg, rgba(0,0,0,.55), rgba(0,0,0,.85)), radial-gradient(circle at 20% 10%, rgba(34,197,94,.25), transparent 50%);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 18px;
  padding: 18px 16px;
  margin-bottom: 16px;
}
.hero h1{margin:0 0 6px;font-size:20px}
.hero p{margin:0;color:rgba(255,255,255,.78);font-size:13px}
.rows{display:flex;flex-direction:column;gap:14px}
.row-title{display:flex;align-items:end;justify-content:space-between;margin:4px 0 8px}
.row-title h2{margin:0;font-size:16px}
.scroller{
  display:flex;
  gap:12px;
  overflow:auto;
  padding-bottom: 6px;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling: touch;
}
.course-card{
  scroll-snap-align:start;
  min-width: 230px;
  max-width: 260px;
  flex: 0 0 auto;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 18px;
  overflow:hidden;
  text-decoration:none;
  color:inherit;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.course-card:hover{
  transform: translateY(-2px);
  border-color: rgba(34,197,94,.35);
  box-shadow: 0 14px 30px rgba(0,0,0,.35);
}
.course-thumb{
  position:relative;
  aspect-ratio: 16/9;
  background: rgba(0,0,0,.4);
}
.course-thumb img{
  width:100%;
  height:100%;
  object-fit: cover;
  display:block;
}
.course-badge{
  position:absolute;left:10px;top:10px;
  background: rgba(0,0,0,.55);
  border: 1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(10px);
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
}
.course-meta{
  padding: 12px 12px 14px;
}
.course-meta .title{
  font-weight:700;
  line-height:1.2;
  margin:0 0 6px;
  font-size:14px;
}
.course-meta .sub{
  margin:0;
  font-size:12px;
  color: rgba(255,255,255,.72);
}
@media (max-width: 520px){
  .course-card{min-width: 78vw; max-width: 84vw;}
}


/* ===== User dropdown ===== */
.user-menu{position:relative}
.user-trigger{
  display:inline-flex;align-items:center;gap:8px;
  padding:10px 12px;border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:inherit;font-weight:900;cursor:pointer;
}
.user-trigger:hover{border-color:rgba(255,255,255,.28)}
.avatar{display:inline-flex;width:26px;height:26px;align-items:center;justify-content:center;
  border-radius:999px;background:rgba(56,189,248,.18);border:1px solid rgba(56,189,248,.30)}
.caret{opacity:.85}
.user-dropdown{z-index:50;
  position:absolute;right:0;top:calc(100% + 10px);
  min-width:220px;
  border:1px solid rgba(148,163,184,.22);
  background:rgba(15,23,42,.96);
  backdrop-filter: blur(10px);
  border-radius:14px;
  box-shadow:0 24px 60px rgba(0,0,0,.45);
  padding:8px;
  display:none;
}
.user-dropdown.open{display:block}
.dd-item{
  width:100%;
  display:flex;align-items:center;gap:10px;
  padding:10px 10px;border-radius:12px;
  text-decoration:none;
  border:0;background:transparent;color:inherit;
  font-weight:900;cursor:pointer;text-align:left;
}
.dd-item:hover{background:rgba(255,255,255,.06)}
.dd-sep{height:1px;background:rgba(148,163,184,.18);margin:6px 4px}
.dd-item.danger{color:#fecaca}

/* ===== Udemy-like cards ===== */
.hero{
  background: linear-gradient(120deg, rgba(0,0,0,.55), rgba(0,0,0,.85)), radial-gradient(circle at 20% 10%, rgba(56,189,248,.20), transparent 50%);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 18px;
  padding: 18px 16px;
  margin-bottom: 16px;
}
.hero h1{margin:0 0 6px;font-size:20px}
.hero p{margin:0;color:rgba(255,255,255,.78);font-size:13px}

.course-grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap:12px;
  justify-items:center;
}
.course{
  display:flex;flex-direction:column;
  width:100%;
  max-width: 320px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 18px;
  overflow:hidden;
  text-decoration:none;color:inherit;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.course:hover{
  transform: translateY(-2px);
  border-color: rgba(56,189,248,.35);
  box-shadow: 0 14px 30px rgba(0,0,0,.35);
}
.course-cover{aspect-ratio: 16/9; background: rgba(0,0,0,.35); position:relative}
.course-cover img{width:100%;height:100%;object-fit:cover;display:block}
.course-body{padding:10px 10px 12px}
.course-title{margin:0 0 6px;font-weight:1000;font-size:13.5px;line-height:1.25}
.course-sub{margin:0 0 8px;font-size:12px;color:rgba(255,255,255,.72)}
.course-meta{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:6px}
.pill{
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  white-space:nowrap;
  font-weight:900;font-size:12px;
}
.progress{
  margin-top:8px;
  height:8px;border-radius:999px;
  background: rgba(255,255,255,.10);
  overflow:hidden;border:1px solid rgba(255,255,255,.08);
}
.progress > div{height:100%;width:20% ;background: rgba(34,197,94,.75);} /* default */


@media (max-width: 520px){
  .course{max-width: none;}
  .course-grid{grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));}
}


</style>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
<style>

/* === Eliane Beautys Theme (non-breaking overrides) === */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Poppins:wght@300;400;500;600&display=swap');

:root{
  --eb-bg1:#fff7fb;
  --eb-bg2:#fff1f7;
  --eb-card:#ffffffcc;
  --eb-text:#111827;
  --eb-muted:#6b7280;
  --eb-border:#f3d2e6;
  --eb-accent:#e11d8a;
  --eb-accent2:#f59e0b;
  --eb-shadow:0 14px 40px rgba(17,24,39,.10);
}

html,body{height:100%}
body{
  font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif !important;
  color:var(--eb-text) !important;
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(225,29,138,.14), transparent 60%),
    radial-gradient(900px 500px at 90% 20%, rgba(245,158,11,.12), transparent 55%),
    linear-gradient(180deg,var(--eb-bg1),var(--eb-bg2)) !important;
}

a{color:var(--eb-accent) !important}
h1,h2,h3{font-family:"Playfair Display",serif !important}

.card, .panel, .course-card, .module-card, .video-card, .box{
  background:var(--eb-card) !important;
  border:1px solid var(--eb-border) !important;
  box-shadow:var(--eb-shadow) !important;
  backdrop-filter: blur(8px);
}

input,select,textarea{
  background:#fff !important;
  color:var(--eb-text) !important;
  border:1px solid var(--eb-border) !important;
}

button, .btn, .primary{
  background: linear-gradient(135deg, var(--eb-accent), #fb7185) !important;
  color:white !important;
  border:0 !important;
  box-shadow: 0 10px 22px rgba(225,29,138,.25) !important;
}

button:hover, .btn:hover, .primary:hover{filter:brightness(1.03)}
button:active, .btn:active, .primary:active{transform:translateY(1px)}

.badge, .tag{
  background: rgba(225,29,138,.10) !important;
  color: var(--eb-accent) !important;
  border: 1px solid var(--eb-border) !important;
}

header, .topbar, .nav{
  background: transparent !important;
  border-bottom: 1px solid rgba(243,210,230,.8) !important;
}

.small, .muted, .hint, .sub{
  color: var(--eb-muted) !important;
}

</style>
</head>
<body>
  
<div class="eb-brand" style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
  <div style="width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,#e11d8a,#fb7185);display:grid;place-items:center;box-shadow:0 10px 22px rgba(225,29,138,.25)">
    <span style="color:#fff;font-weight:700;letter-spacing:.5px">EB</span>
  </div>
  <div style="line-height:1">
    <div style="font-family:'Playfair Display',serif;font-size:1.15rem">Eliane Beautys</div>
    <div style="font-size:.85rem;color:var(--eb-muted)">Plataforma de Cursos</div>
  </div>
</div>
<header>
    <div>
      <div class="title">Mis cursos</div>
      <div class="muted">AquÃ­ verÃ¡s solo los cursos que estÃ¡n habilitados para tu correo.</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <a class="btn secondary" href="index.html">Volver</a>

      <div class="user-menu" id="userMenu" style="display:none;">
        <button class="user-trigger" id="userTrigger" aria-haspopup="menu" aria-expanded="false">
          <span class="avatar" aria-hidden="true">ðŸ‘¤</span>
          <span id="userName">Cargandoâ€¦</span>
          <span class="caret" aria-hidden="true">â–¾</span>
        </button>

        <div class="user-dropdown" id="userDropdown" role="menu">
          <a class="dd-item" href="account.html" role="menuitem">ðŸ“š Mis cursos</a>
          <a class="dd-item" href="account.html" role="menuitem">ðŸ‘¤ Mi perfil</a>
          <div class="dd-sep"></div>
          <button class="dd-item danger" id="logout" role="menuitem">ðŸšª Cerrar sesiÃ³n</button>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div id="status" class="muted">Cargandoâ€¦</div>
    <div class="hero"><h1>Mis cursos</h1><p>Elige un curso y continÃºa donde lo dejaste.</p></div><div id="list" class="course-grid"></div>
  </div>

<script>
function escapeHtml_(s){
  return String(s||"").replace(/[&<>"']/g,(c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
}

  const API_URL = "https://eliane-beautys-proxy-4wlw.vercel.app/api";

  function jsonp(action, payload) {
    return new Promise((resolve, reject) => {
      const cb = "cb_" + Math.random().toString(36).slice(2);
      const params = new URLSearchParams();
      params.set("action", action);
      Object.entries(payload || {}).forEach(([k,v]) => {
        if (v === undefined || v === null) return;
        params.set(k, String(v));
      });
      params.set("callback", cb);

      const script = document.createElement("script");
      script.src = API_URL + "?" + params.toString();
      script.async = true;

      window[cb] = (data) => {
        cleanup();
        resolve(data);
      };

      function cleanup() {
        try { delete window[cb]; } catch(e) { window[cb] = undefined; }
        if (script.parentNode) script.parentNode.removeChild(script);
      }

      script.onerror = () => {
        cleanup();
        reject(new Error("No se pudo conectar (JSONP)."));
      };

      document.body.appendChild(script);
    });
  }

  const token = sessionStorage.getItem("pasir_token");
  if (!token) location.href = "login.html";
  (async () => {
    try {
      const r = await jsonp("me", { token });
      if (!r.ok) {
        sessionStorage.removeItem("pasir_token");
        return location.href = "login.html";
      }

      const status = document.getElementById("status");
      const list = document.getElementById("list");

      const courses = (r.courses || r.cursos || []);
    if (!courses || courses.length === 0) {
        status.textContent = "AÃºn no tienes cursos habilitados. Si ya pagaste, espera a que lo active por WhatsApp.";
        list.innerHTML = "";
        return;
      }

      
      status.textContent = "";

      // Opcional: mapea imÃ¡genes locales por courseId.
      // Sube tus portadas a /assets/courses/ (en tu repo) con el nombre del courseId:
      // assets/courses/logo8-basico.jpg
      const COURSE_IMAGES = {
        // "logo8-basico": "assets/courses/logo8-basico.jpg",
      };

      
const cards = courses.map(c => {
  const img =
    c.imageUrl ||
    COURSE_IMAGES[c.courseId] ||
    `assets/courses/${encodeURIComponent(c.courseId)}.jpg`;

  // Si tu API devuelve progreso, puedes reemplazar esto por c.progress (0-100)
  const pRaw = (c.progress ?? c.progreso);
  const pNum = (typeof pRaw === "number") ? pRaw : (typeof pRaw === "string" ? parseFloat(pRaw) : NaN);
  const progress = Number.isFinite(pNum) ? Math.max(0, Math.min(100, pNum)) : 0;

  return `
    <a class="course" href="course.html?courseId=${encodeURIComponent(c.courseId)}" aria-label="${escapeHtml_(c.title || c.courseTitle || '')}">
      <div class="course-cover">
        <img src="${img}" alt="${escapeHtml_(c.title || c.courseTitle || '')}"
          onerror="this.onerror=null;this.src='icons/icon-512.png';" />
      </div>
      <div class="course-body">
        <p class="course-title">${escapeHtml_(c.title || c.courseTitle || '')}</p>
        <p class="course-sub">${escapeHtml_(c.courseId)}</p>
        <div class="progress" aria-label="Progreso"><div style="width:${progress}%"></div></div>
        <div class="course-meta">
          <span class="pill">Continuar</span>
          <span class="pill">${progress}%</span>
        </div>
      </div>
    </a>
  `;
}).join("");

list.innerHTML = cards;
} catch (e) {
      document.getElementById("status").innerHTML = '<div class="err">'+(e.message || e)+'</div>';
    }
  })();
</script>


<script>
(function(){
  const token = sessionStorage.getItem("pasir_token");
  const userMenu = document.getElementById("userMenu");
  const userTrigger = document.getElementById("userTrigger");
  const userDropdown = document.getElementById("userDropdown");
  const userNameEl = document.getElementById("userName");

  function closeMenu(){
    if (!userDropdown) return;
    userDropdown.classList.remove("open");
    if (userTrigger) userTrigger.setAttribute("aria-expanded","false");
  }
  function openMenu(){
    if (!userDropdown) return;
    userDropdown.classList.add("open");
    if (userTrigger) userTrigger.setAttribute("aria-expanded","true");
  }
  if (userTrigger && userDropdown){
    userTrigger.addEventListener("click", (e)=>{
      e.stopPropagation();
      userDropdown.classList.contains("open") ? closeMenu() : openMenu();
    });
    document.addEventListener("click", ()=> closeMenu());
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeMenu(); });
    userDropdown.addEventListener("click", (e)=> e.stopPropagation());
  }

  if (token && userMenu) userMenu.style.display = "inline-block";

  async function hydrateUser(){
    const storedName = sessionStorage.getItem("pasir_email") || sessionStorage.getItem("pasir_name");
    if (storedName && userNameEl) userNameEl.textContent = storedName;

    if (!token) return;
    try{
      const r = await jsonp("me", { token });
      if (!r.ok) return;
      const email = (r.user && (r.user.email || r.user.correo)) || r.email || sessionStorage.getItem("pasir_email") || "";

      if (email && userNameEl) userNameEl.textContent = email;
      if (email) sessionStorage.setItem("pasir_email", email);
      if (userMenu) userMenu.style.display = "inline-block";
    }catch(e){}
  }
  hydrateUser();

  const logoutBtn = document.getElementById("logout");
  if (logoutBtn){
    logoutBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      sessionStorage.removeItem("pasir_token");
      sessionStorage.removeItem("pasir_name");
      location.href = "index.html";
    });
  }
})();
</script>

<script>
  // PWA: registrar Service Worker
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    });
  }
</script>
</body>
</html>
