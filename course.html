<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eliane Beautys | Curso</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.04);
      --stroke:rgba(148,163,184,.22);
      --text:#f9fafb;
      --muted:rgba(255,255,255,.70);
      --green:#22c55e;
      --blue:#38bdf8;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
    a{color:inherit}

    /* Header */
    header{
      position:sticky;top:0;z-index:20;
      padding:14px 16px;
      border-bottom:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(11,18,32,.96), rgba(11,18,32,.86));
      backdrop-filter: blur(8px);
      display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
    }
    #courseTitle{font-weight:1000;font-size:20px;}
    .muted{color:var(--muted)}

    .top-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .topbtn{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:12px;text-decoration:none;font-weight:900;
      border:1px solid transparent;
    }
    .secondary{background:rgba(56,189,248,.18);border-color:rgba(56,189,248,.35)}
    .primary{background:var(--green);color:#071018;border:0;cursor:pointer}

    /* Layout like Udemy mobile: player arriba + m√≥dulos abajo */
    .container{max-width:1080px;margin:0 auto;padding:14px 14px 28px}
    .player-wrap{
      border:1px solid var(--stroke);
      border-radius:18px;
      overflow:hidden;
      background:var(--panel2);
      box-shadow:0 18px 40px rgba(0,0,0,.35);
    }
    .player{
      position:relative;
      width:100%;
      padding-top:56.25%;
      background:rgba(0,0,0,.25);
    }
    iframe{position:absolute;inset:0;width:100%;height:100%}

    .player-meta{
      display:flex;justify-content:space-between;align-items:flex-start;gap:10px;
      padding:12px 12px 12px;
      border-top:1px solid var(--stroke);
    }
    .player-meta .left{min-width:0}
    .player-meta .left .now{font-weight:900}
    .player-meta .left .hint{font-size:12px;color:var(--muted);margin-top:4px}
    .player-meta .right{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .smallbtn{
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      text-decoration:none;font-weight:900;
    }
    .smallbtn:hover{border-color:rgba(255,255,255,.28)}

    /* Curriculum */
    .curriculum{
      margin-top:14px;
      border:1px solid var(--stroke);
      border-radius:18px;
      overflow:hidden;
      background:var(--panel2);
    }
    .curriculum-h{
      padding:14px 14px;
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      border-bottom:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
    }
    .curriculum-h h2{margin:0;font-size:16px;letter-spacing:.2px}
    .curriculum-h .sub{font-size:12px;color:var(--muted)}

    #modules{display:flex;flex-direction:column}

    /* Udemy-like rows */
    .mod{
      width:100%;
      text-align:left;
      display:flex;gap:12px;align-items:center;
      padding:12px 14px;
      border:0;
      background:transparent;
      color:inherit;
      cursor:pointer;
      border-bottom:1px solid rgba(148,163,184,.18);
    }
    .mod:last-child{border-bottom:0}
    .mod:hover{background:rgba(255,255,255,.04)}
    .mod.active{background:rgba(34,197,94,.10)}
    .mod .thumb{
      width:84px;aspect-ratio:16/9;border-radius:12px;overflow:hidden;
      background:rgba(0,0,0,.35);flex:0 0 auto;
      border:1px solid rgba(255,255,255,.10);
    }
    .mod .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .mod .info{min-width:0;flex:1}
    .mod .info .t{margin:0;font-weight:900;font-size:14px;line-height:1.2}
    .mod .info .s{margin:6px 0 0;font-size:12px;color:var(--muted)}
    .mod .meta{
      flex:0 0 auto;
      display:flex;align-items:center;gap:8px;
      color:rgba(255,255,255,.85);
      font-weight:900;
      font-size:12px;
    }
    .pill{
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      white-space:nowrap;
    }

    .err{color:#fca5a5;font-weight:800;white-space:pre-wrap;padding:12px 14px}

    /* Responsive refinements */
    @media (max-width: 520px){
      header{padding:12px 12px}
      .container{padding:12px 12px 24px}
      .mod .thumb{width:74px}
      .mod .meta{display:none}
    }
  

    /* Layout split (tipo Udemy) en pantallas anchas / horizontal */
    @media (min-width: 900px){
      .container{
        display:grid;
        grid-template-columns: 1.45fr 1fr;
        gap:14px;
        align-items:start;
      }
      .curriculum{margin-top:0; max-height: calc(100vh - 94px); overflow:auto}
    }
    /* Horizontal en m√≥vil: que no se vea gigante */
    @media (orientation: landscape) and (max-height: 520px){
      .container{padding:10px 10px 18px}
      .player{padding-top:0;height: calc(100vh - 150px);}
      iframe{height:100%}
      .curriculum{max-height: calc(100vh - 94px); overflow:auto}
    }


    /* User dropdown */
    .user-menu{position:relative}
    .user-trigger{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:inherit;font-weight:900;cursor:pointer;
    }
    .user-trigger:hover{border-color:rgba(255,255,255,.28)}
    .avatar{display:inline-flex;width:26px;height:26px;align-items:center;justify-content:center;
      border-radius:999px;background:rgba(56,189,248,.18);border:1px solid rgba(56,189,248,.30)}
    .caret{opacity:.85}
    .user-dropdown{z-index:50;
      position:absolute;right:0;top:calc(100% + 10px);
      min-width:210px;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(15,23,42,.96);
      backdrop-filter: blur(10px);
      border-radius:14px;
      box-shadow:0 24px 60px rgba(0,0,0,.45);
      padding:8px;
      display:none;
    }
    .user-dropdown.open{display:block}
    .dd-item{
      width:100%;
      display:flex;align-items:center;gap:10px;
      padding:10px 10px;border-radius:12px;
      text-decoration:none;
      border:0;background:transparent;color:inherit;
      font-weight:900;cursor:pointer;text-align:left;
    }
    .dd-item:hover{background:rgba(255,255,255,.06)}
    .dd-sep{height:1px;background:rgba(148,163,184,.18);margin:6px 4px}
    .dd-item.danger{color:#fecaca}

  </style>



<style>#openYT{display:none !important;}</style>

<style>
/* ==== Player con API + controles propios ==== */
.yt-player{
  position:absolute; inset:0;
  width:100%; height:100%;
}
/* Controles propios (funcionan en m√≥vil) */
.cc-wrap{
  display:flex; gap:10px; align-items:center; flex-wrap:nowrap;
}
.cc-btn{
  width:44px; height:38px;
  border:0; border-radius:12px;
  background:rgba(255,255,255,.10);
  color:#fff; font-size:18px;
}
.cc-seek{ flex:1; min-width: 120px; }
.cc-time{ font-variant-numeric: tabular-nums; opacity:.85; font-size: 13px; white-space: nowrap; }

/* Pantalla completa: estira el contenedor del player */
.player-wrap:fullscreen{
  width:100vw; height:100vh;
  max-width:none;
  border-radius:0;
}
.player-wrap:fullscreen .player{
  padding-top:0 !important;
  height:100vh !important;
}
</style>


<style>
/* ==== Bloquear interacci√≥n directa con el player (taps) y mostrar controles propios al tocar ==== */
.player-wrap{ position:relative !important; }

/* Cubre el √°rea del video para que NO se puedan tocar los controles nativos */
.tap-shield{
  position:absolute;
  left:0; top:0; right:0;
  /* altura del √°rea video (la parte superior de la card). Ajusta si cambia el layout */
  height: calc(100% - 0px);
  z-index: 50;
  background: transparent;
  pointer-events: auto;
}

/* Controles propios flotando sobre el video (abajo) */
#ccWrap{
  position:absolute !important;
  left:12px; right:12px;
  bottom:28px;
  z-index: 60;
  opacity: 0;
  transform: translateY(8px);
  pointer-events: none;
  transition: opacity .18s ease, transform .18s ease;
}

/* Estado visible */
#ccWrap.is-visible{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

/* En horizontal/fullscreen, que el overlay y controles sigan funcionando */
.player-wrap:fullscreen #ccWrap,
.player-wrap:-webkit-full-screen #ccWrap{
  left:16px; right:16px; bottom:28px;
}
.player-wrap:fullscreen .tap-shield,
.player-wrap:-webkit-full-screen .tap-shield{
  left:0; top:0; right:0; bottom:0;
  height: 100%;
}

/* Importante: que el tapShield NO cubra los controles */
#ccWrap{ }
</style>


<style>
/* Separar t√≠tulo del √°rea de controles */
.player-meta .left{ margin-top: 22px !important; }

/* Bot√≥n velocidad */
.cc-speed{ width:56px !important; font-size:14px !important; }
</style>


<style>
/* Subir controles un poco m√°s arriba para no tapar t√≠tulo */
#ccWrap{ bottom:28px !important; }
</style>

<style>

/* === Eliane Beautys Theme (non-breaking overrides) === */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Poppins:wght@300;400;500;600&display=swap');

:root{
  --eb-bg1:#fff7fb;
  --eb-bg2:#fff1f7;
  --eb-card:#ffffffcc;
  --eb-text:#111827;
  --eb-muted:#6b7280;
  --eb-border:#f3d2e6;
  --eb-accent:#e11d8a;
  --eb-accent2:#f59e0b;
  --eb-shadow:0 14px 40px rgba(17,24,39,.10);
}

html,body{height:100%}
body{
  font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif !important;
  color:var(--eb-text) !important;
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(225,29,138,.14), transparent 60%),
    radial-gradient(900px 500px at 90% 20%, rgba(245,158,11,.12), transparent 55%),
    linear-gradient(180deg,var(--eb-bg1),var(--eb-bg2)) !important;
}

a{color:var(--eb-accent) !important}
h1,h2,h3{font-family:"Playfair Display",serif !important}

.card, .panel, .course-card, .module-card, .video-card, .box{
  background:var(--eb-card) !important;
  border:1px solid var(--eb-border) !important;
  box-shadow:var(--eb-shadow) !important;
  backdrop-filter: blur(8px);
}

input,select,textarea{
  background:#fff !important;
  color:var(--eb-text) !important;
  border:1px solid var(--eb-border) !important;
}

button, .btn, .primary{
  background: linear-gradient(135deg, var(--eb-accent), #fb7185) !important;
  color:white !important;
  border:0 !important;
  box-shadow: 0 10px 22px rgba(225,29,138,.25) !important;
}

button:hover, .btn:hover, .primary:hover{filter:brightness(1.03)}
button:active, .btn:active, .primary:active{transform:translateY(1px)}

.badge, .tag{
  background: rgba(225,29,138,.10) !important;
  color: var(--eb-accent) !important;
  border: 1px solid var(--eb-border) !important;
}

header, .topbar, .nav{
  background: transparent !important;
  border-bottom: 1px solid rgba(243,210,230,.8) !important;
}

.small, .muted, .hint, .sub{
  color: var(--eb-muted) !important;
}

</style>
</head>
<body>
  
<div class="eb-brand" style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
  <div style="width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,#e11d8a,#fb7185);display:grid;place-items:center;box-shadow:0 10px 22px rgba(225,29,138,.25)">
    <span style="color:#fff;font-weight:700;letter-spacing:.5px">EB</span>
  </div>
  <div style="line-height:1">
    <div style="font-family:'Playfair Display',serif;font-size:1.15rem">Eliane Beautys</div>
    <div style="font-size:.85rem;color:var(--eb-muted)">Plataforma de Cursos</div>
  </div>
</div>
<header>
    <div>
      <div id="courseTitle">Cargando‚Ä¶</div>
      <div id="nowPlaying" class="muted"></div>
    </div>
    <div class="top-actions">
      <a class="topbtn secondary" href="account.html">‚¨Ö Mis cursos</a>

      <div class="user-menu" id="userMenu" style="display:none;">
        <button class="user-trigger" id="userTrigger" aria-haspopup="menu" aria-expanded="false">
          <span class="avatar" aria-hidden="true">üë§</span>
          <span id="userName">Cargando‚Ä¶</span>
          <span class="caret" aria-hidden="true">‚ñæ</span>
        </button>

        <div class="user-dropdown" id="userDropdown" role="menu">
          <a class="dd-item" href="account.html" role="menuitem">üìö Mis cursos</a>
          <a class="dd-item" href="account.html" role="menuitem">üë§ Mi perfil</a>
          <div class="dd-sep"></div>
          <button class="dd-item danger" id="logout" role="menuitem">üö™ Cerrar sesi√≥n</button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="player-wrap" aria-label="Reproductor">
      <div class="player">
        <div id="player" class="yt-player"></div>

<div id="tapShield" class="tap-shield" aria-label="Zona protegida del video"></div>

      </div>
      <div class="player-meta">
        <div class="left">
          <div class="now" id="nowTitle">Reproduciendo</div>
          
        </div>
        <div class="right">

<div class="cc-wrap" id="ccWrap" aria-label="Controles del video">
  <button class="cc-btn" id="ccPlay" type="button" aria-label="Reproducir / Pausar">‚ñ∂</button>
  <input class="cc-seek" id="ccSeek" type="range" min="0" max="1000" value="0" aria-label="L√≠nea de tiempo">
  <span class="cc-time" id="ccTime">0:00 / 0:00</span>
  <button class="cc-btn cc-speed" id="ccSpeedBtn" type="button" aria-label="Velocidad">1x</button>
  <button class="cc-btn" id="ccFs" type="button" aria-label="Pantalla completa">‚õ∂</button>
</div>


          <!-- Link externo oculto para mantener el reproductor limpio -->
          <a class="smallbtn" id="openYT" href="#" target="_blank" rel="noopener" style="display:none">Ver en YouTube</a>
        </div>
    </section>

    <section class="curriculum" aria-label="M√≥dulos">
      <div class="curriculum-h">
        <div>
          <h2>M√≥dulos</h2>
          <div class="sub">Selecciona una clase para reproducir</div>
        </div>
        <div class="sub" id="countMods"></div>
      </div>

      <div id="modules"></div>
      <div id="msg" class="err"></div>
    </section>
  </div>

  
<script>
/* ===== YouTube IFrame Player API (sin UI de YouTube) + controles propios ===== */
let YTPlayer = null;
let YTReady = false;
let pendingVideoId = null;

function fmtTime_(sec){
  sec = Math.max(0, Math.floor(sec || 0));
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return m + ":" + String(s).padStart(2, "0");
}

function normalizeVideoId_(value){
  if (!value) return "";
  const v = String(value).trim();
  if (/^[a-zA-Z0-9_-]{11}$/.test(v)) return v;
  const m = v.match(/(?:youtu\.be\/|v=|\/embed\/)([a-zA-Z0-9_-]{11})/);
  return m ? m[1] : "";
}

function ensureYT_(){
  if (document.getElementById("ytApiLoaded")) return;
  const s = document.createElement("script");
  s.id = "ytApiLoaded";
  s.src = "https://www.youtube.com/iframe_api";
  s.async = true;
  document.head.appendChild(s);
}

function loadVideoById_(videoId, autoplay){
  const vid = normalizeVideoId_(videoId);
  if (!vid) return;
  if (YTReady && YTPlayer && typeof YTPlayer.loadVideoById === "function"){
    YTPlayer.loadVideoById({ videoId: vid, startSeconds: 0 });
    if (autoplay) YTPlayer.playVideo();
  } else {
    pendingVideoId = vid;
  }
}

function setupControls_(){
  const btn = document.getElementById("ccPlay");
  const seek = document.getElementById("ccSeek");
  const time = document.getElementById("ccTime");
  const fs = document.getElementById("ccFs");
  const wrap = document.querySelector(".player-wrap");
  let seeking = false;


  const speedBtn = document.getElementById("ccSpeedBtn");
  const speedRates = [0.5, 0.75, 1, 1.25, 1.5, 2];
  let speedIdx = 2; // 1x

  function applySpeed_(){
    if (!YTPlayer) return;
    const r = speedRates[speedIdx] || 1;
    try{ YTPlayer.setPlaybackRate(r); }catch(e){}
    if (speedBtn) speedBtn.textContent = (r % 1 === 0 ? String(r).replace('.0','') : String(r)) + "x";
  }

  if (speedBtn){
    speedBtn.addEventListener("click", () => {
      speedIdx = (speedIdx + 1) % speedRates.length;
      applySpeed_();
    });
  }

  if (btn){
    btn.addEventListener("click", () => {
      if (!YTPlayer) return;
      const st = YTPlayer.getPlayerState();
      if (st === 1) YTPlayer.pauseVideo();
      else YTPlayer.playVideo();
    });
  }

  if (seek){
    seek.addEventListener("input", () => { seeking = true; });
    seek.addEventListener("change", () => {
      if (!YTPlayer) return;
      const dur = YTPlayer.getDuration ? YTPlayer.getDuration() : 0;
      const v = Number(seek.value || 0) / 1000;
      if (dur > 0) YTPlayer.seekTo(dur * v, true);
      seeking = false;
    });
  }

  // Fullscreen propio (funciona en m√≥vil, depende del navegador)
  async function toggleFs(){
    if (!wrap) return;
    try{
      const isFs = document.fullscreenElement || document.webkitFullscreenElement;
      if (isFs){
        if (document.exitFullscreen) await document.exitFullscreen();
        else if (document.webkitExitFullscreen) await document.webkitExitFullscreen();
      } else {
        if (wrap.requestFullscreen) await wrap.requestFullscreen();
        else if (wrap.webkitRequestFullscreen) await wrap.webkitRequestFullscreen();
      }
    }catch(e){}
  }
  if (fs) fs.addEventListener("click", toggleFs);

  // Actualiza UI
  setInterval(() => {
    if (!YTPlayer) return;
    if (seek && !seeking){
      const dur = YTPlayer.getDuration ? YTPlayer.getDuration() : 0;
      const cur = YTPlayer.getCurrentTime ? YTPlayer.getCurrentTime() : 0;
      if (dur > 0){
        seek.value = String(Math.round((cur / dur) * 1000));
        if (time) time.textContent = fmtTime_(cur) + " / " + fmtTime_(dur);
      }
    }
  }, 500);
}

// YouTube API callback
window.onYouTubeIframeAPIReady = function(){
  YTReady = true;

  YTPlayer = new YT.Player("player", {
    width: "100%",
    height: "100%",
    playerVars: {
      controls: 0,          // sin botones de YouTube (no share, no YouTube button)
      rel: 0,
      modestbranding: 1,
      iv_load_policy: 3,
      playsinline: 1,
      disablekb: 1,
      fs: 0                // fullscreen lo manejamos nosotros (bot√≥n ‚õ∂)
    },
    events: {
      onReady: () => {
        setupControls_();
        if (pendingVideoId){
          loadVideoById_(pendingVideoId, false);
          pendingVideoId = null;
        }
      },
      onStateChange: (e) => {
        const btn = document.getElementById("ccPlay");
        if (!btn) return;
        if (e.data === 1) btn.textContent = "‚è∏";
        else btn.textContent = "‚ñ∂";
      }
    }
  });
};

ensureYT_();
</script>

<script>

function cleanEmbedUrl_(url){
  const u = String(url||"").trim();
  if(!u) return "";
  // Cambia a youtube-nocookie cuando sea embed de YouTube
  let out = u.replace("https://www.youtube.com/embed/","https://www.youtube-nocookie.com/embed/")
             .replace("http://www.youtube.com/embed/","https://www.youtube-nocookie.com/embed/")
             .replace("https://youtu.be/","https://www.youtube-nocookie.com/embed/");
  // Asegura par√°metros para reducir elementos de YouTube (no se puede ocultar 100% por pol√≠ticas de YouTube)
  const hasQuery = out.includes("?");
  const params = new URLSearchParams(hasQuery ? out.split("?")[1] : "");
  if(!params.has("rel")) params.set("rel","0");
  if(!params.has("modestbranding")) params.set("modestbranding","1");
  if(!params.has("iv_load_policy")) params.set("iv_load_policy","3");
  if(!params.has("playsinline")) params.set("playsinline","1");
  if(!params.has("controls")) params.set("controls","1");
  if(!params.has("fs")) params.set("fs","1");         // fullscreen on
  if(!params.has("disablekb")) params.set("disablekb","0");
  out = out.split("?")[0] + "?" + params.toString();
  return out;
}

function escapeHtml_(s){
  return String(s||"").replace(/[&<>"']/g,(c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
}

  const API_URL = "https://eliane-beautys-proxy-4wlw.vercel.app/api";

  function jsonp(action, payload) {
    return new Promise((resolve, reject) => {
      const cb = "cb_" + Math.random().toString(36).slice(2);
      const params = new URLSearchParams();
      params.set("action", action);
      Object.entries(payload || {}).forEach(([k,v]) => {
        if (v === undefined || v === null) return;
        params.set(k, String(v));
      });
      params.set("callback", cb);

      const script = document.createElement("script");
      script.src = API_URL + "?" + params.toString();
      script.async = true;

      window[cb] = (data) => {
        cleanup();
        resolve(data);
      };

      function cleanup() {
        try { delete window[cb]; } catch(e) { window[cb] = undefined; }
        if (script.parentNode) script.parentNode.removeChild(script);
      }

      script.onerror = () => {
        cleanup();
        reject(new Error("No se pudo conectar (JSONP)."));
      };

      document.body.appendChild(script);
    });
  }

  const token = sessionStorage.getItem("pasir_token");
  if (!token) location.href = "login.html";

  const params = new URLSearchParams(location.search);
  const courseId = params.get("courseId");

  document.getElementById("logout").onclick = () => {
    sessionStorage.removeItem("pasir_token");
    location.href = "index.html";
  };

  function setActive(btn) {
    document.querySelectorAll(".mod").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  }

  function showError(text) {
    document.getElementById("msg").textContent = text || "";
  }

  (async () => {
    if (!courseId) {
      showError("Falta courseId en la URL. Ej: course.html?courseId=logo8-basico");
      return;
    }

    const r = await jsonp("course", { token, courseId });
    if (!r.ok) {
      showError(r.error || "No se pudo cargar el curso.");
      if ((r.error || "").toLowerCase().includes("no autorizado")) {
        setTimeout(()=> location.href="account.html", 800);
      }
      return;
    }

    document.getElementById("courseTitle").textContent = r.course.title || courseId;

    const box = document.getElementById("modules");
    box.innerHTML = "";
    showError("");

    document.getElementById("countMods").textContent = (r.modules?.length||0) + " clases";
    r.modules.forEach((m, idx) => {
      const b = document.createElement("button");
      b.className = "mod";
      const videoId = ((m.videoId || m.videoid || m.video)) || (m.embedUrl || "").split("/embed/")[1]?.split("?")[0] || "";
      const thumb = videoId ? `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg` : "icons/icon-192.png";
      b.innerHTML = `
        <div class="thumb"><img src="${thumb}" alt=""></div>
        <div class="info">
          <p class="t">${escapeHtml_(`${m.order}. ${(m.title || m.moduleTitle || '')}`)}</p>
          <p class="s">Toca para reproducir</p>
        </div>
      `;
      b.onclick = () => {
        setActive(b);
        loadVideoById_(videoId, false);
        document.getElementById("nowPlaying").textContent = "Reproduciendo: " + (m.title || m.moduleTitle || "Clase");
        const nt = document.getElementById("nowTitle"); if (nt) nt.textContent = (m.title || m.moduleTitle || "Clase");
        const yt = document.getElementById("openYT");
        if (yt) {
          const vid = ((m.videoId || m.videoid || m.video)) || (m.embedUrl || "").split("/embed/")[1]?.split("?")[0] || "";
          yt.removeAttribute("href");
        }
      };
      box.appendChild(b);
      // autoplay eliminado: el alumno debe presionar play manualmente
    });
  })().catch(err => {
    showError(err.message || String(err));
  });
</script>

  <script>
  // PWA: registrar Service Worker
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    });
  }
</script>

<script>
(function(){
  const token = sessionStorage.getItem("pasir_token");
  const userMenu = document.getElementById("userMenu");
  const userTrigger = document.getElementById("userTrigger");
  const userDropdown = document.getElementById("userDropdown");
  const userNameEl = document.getElementById("userName");

  // Toggle dropdown
  function closeMenu(){
    if (!userDropdown) return;
    userDropdown.classList.remove("open");
    if (userTrigger) userTrigger.setAttribute("aria-expanded","false");
  }
  function openMenu(){
    if (!userDropdown) return;
    userDropdown.classList.add("open");
    if (userTrigger) userTrigger.setAttribute("aria-expanded","true");
  }
  if (userTrigger && userDropdown){
    userTrigger.addEventListener("click", (e)=>{
      e.stopPropagation();
      userDropdown.classList.contains("open") ? closeMenu() : openMenu();
    });
    document.addEventListener("click", ()=> closeMenu());
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeMenu(); });
    userDropdown.addEventListener("click", (e)=> e.stopPropagation());
  }

  // Fill name (uses jsonp() already defined in this page)
  if (token && userMenu) userMenu.style.display = "inline-block";

  async function hydrateUser(){
    const storedName = sessionStorage.getItem("pasir_email");
    if (storedName && userNameEl) userNameEl.textContent = storedName;
    if (!token) return;
    try{
      const r = await jsonp("me", { token });
      if (!r.ok) return;
      const email = (r.user && (r.user.email || r.user.correo)) || r.email || sessionStorage.getItem("pasir_email") || "‚Äî";
      const label = email;

      if (userNameEl) userNameEl.textContent = label;
      sessionStorage.setItem("pasir_email", label);
      if (userMenu) userMenu.style.display = "inline-block";
    }catch(e){}
  }
  hydrateUser();

  // Logout (keep behavior: clear token and go to index)
  const logoutBtn = document.getElementById("logout");
  if (logoutBtn){
    logoutBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      sessionStorage.removeItem("pasir_token");
      sessionStorage.removeItem("pasir_email");
      sessionStorage.removeItem("pasir_name");
      location.href = "index.html";
    });
  }
})();
</script>


<script>
/* ==== Mostrar controles propios al tocar el video (y bloquear toques al player nativo) ==== */
(function(){
  const shield = document.getElementById("tapShield");
  const wrap = document.getElementById("ccWrap");
  let hideTimer = null;

  function showControls(){
    if (!wrap) return;
    wrap.classList.add("is-visible");
    if (hideTimer) clearTimeout(hideTimer);
    hideTimer = setTimeout(() => {
      wrap.classList.remove("is-visible");
    }, 3200);
  }

  // Tocar el video: solo muestra controles, NO deja interactuar con el iframe
  if (shield){
    shield.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      showControls();
    }, {passive:false});

    shield.addEventListener("touchstart", (e) => {
      e.preventDefault();
      e.stopPropagation();
      showControls();
    }, {passive:false});
  }

  // Si tocan el √°rea de controles, no ocultar inmediatamente
  if (wrap){
    wrap.addEventListener("pointerdown", () => {
      if (hideTimer) clearTimeout(hideTimer);
    });
    wrap.addEventListener("pointerup", () => {
      showControls();
    });
  }

  // Exponer para otros scripts si hace falta
  window.__showCustomControls = showControls;
})();
</script>

</body>
</html>


<script>
(function(){
  const token = sessionStorage.getItem("pasir_token");
  const userMenu = document.getElementById("userMenu");
  const userTrigger = document.getElementById("userTrigger");
  const userDropdown = document.getElementById("userDropdown");
  const userNameEl = document.getElementById("userName");

  // Toggle dropdown
  function closeMenu(){
    if (!userDropdown) return;
    userDropdown.classList.remove("open");
    if (userTrigger) userTrigger.setAttribute("aria-expanded","false");
  }
  function openMenu(){
    if (!userDropdown) return;
    userDropdown.classList.add("open");
    if (userTrigger) userTrigger.setAttribute("aria-expanded","true");
  }
  if (userTrigger && userDropdown){
    userTrigger.addEventListener("click", (e)=>{
      e.stopPropagation();
      userDropdown.classList.contains("open") ? closeMenu() : openMenu();
    });
    document.addEventListener("click", ()=> closeMenu());
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeMenu(); });
    userDropdown.addEventListener("click", (e)=> e.stopPropagation());
  }

  // Fill name (uses jsonp() already defined in this page)
  if (token && userMenu) userMenu.style.display = "inline-block";

  async function hydrateUser(){
    const storedName = sessionStorage.getItem("pasir_email");
    if (storedName && userNameEl) userNameEl.textContent = storedName;
    if (!token) return;
    try{
      const r = await jsonp("me", { token });
      if (!r.ok) return;
      const email = (r.user && (r.user.email || r.user.correo)) || r.email || sessionStorage.getItem("pasir_email") || "‚Äî";
      const label = email;

      if (userNameEl) userNameEl.textContent = label;
      sessionStorage.setItem("pasir_email", label);
      if (userMenu) userMenu.style.display = "inline-block";
    }catch(e){}
  }
  hydrateUser();

  // Logout (keep behavior: clear token and go to index)
  const logoutBtn = document.getElementById("logout");
  if (logoutBtn){
    logoutBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      sessionStorage.removeItem("pasir_token");
      sessionStorage.removeItem("pasir_email");
      sessionStorage.removeItem("pasir_name");
      location.href = "index.html";
    });
  }
})();
</script>

</body>
</html>
